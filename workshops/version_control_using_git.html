<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Version Control Using Git</title>
    <meta charset="utf-8" />
    <meta name="author" content="Ade Fewings, Aaron Owen" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/metropolis-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Version Control Using Git
### Ade Fewings, Aaron Owen
### Bangor University
### 2019/11/10 (updated: 2020-09-30)

---


# Research Computing Community

- Background

  - SuperComputing Wales
  
  - Research Software Engineers supporting Bangor researchers

- Future
  
  - Collate expert knowledge into an open and shared centralised repository
      - [Yammer](https://www.yammer.com/bangor.ac.uk/#/threads/inGroup?type=in_group&amp;feedId=12756205568&amp;view=all)
      - [Github](https://github.com/BangorUniversity/Research-Computing-Community)
  
  - Workshops
  
  - Projects
  
  - Acknowledgements

---

# Training Workshops

- Introduction to the Linux Shell

- **Version Control Using Git**
  - https://swcarpentry.github.io/git-novice/
  
- Programming Principles and Practice using Python

- Advanced Python

- Parallel Processing in Python

- Machine Learning with Python*


See and discuss on the Yammer group.

Suggestions for new training welcome.


---

# Theory: Version Control Systems

- A tool that records changes to files or a set of files over time

- Can recall specific versions of files

  - No need for *file-new, file-new-new, file-old, file-latest, file-working*

- Not restricted to software development

- Can be local, centralised and decentralised

- Simplifies collaboration on a project with others
  - Users are notified when there is a possibility your changes may conflict with another person's work

---

# Theory: Version Control Systems

- Users can collaborate on documents in parallel - Paper Writing

- Users can revert to a previous version - Unlimited undo

- Many different version control systems

  - CVS, SVN, **Git**, Mercurial

---

# Theory: Version Control Systems

- Start with a base version of a document

- Records changes you make each step of the way

- Can rewind to the base document and playback each change

&lt;img src="images/play-changes.svg"&gt;

---

# Theory: Version Control Systems

- Think of the changes as separate from the document itself

- Different sets of changes can result in different versions of the document

- Two users can make independent sets of changes on the same document

&lt;img src="images/versions.svg"&gt;

---

# Theory: Version Control Systems 

- If users make changes to different parts of a document
  - You can incorporate two sets of changes into the same base document
  
- If users make changes to the same part of a document
  - This will result in a *conflict* and needs to be reviewed

&lt;img src="images/merge.svg"&gt;

---

# Git and GitHub

### Github

- *GitHub* is a Git repository hosting service, but it adds many of its own features

- *Git* is a command-line tool but Git also integrates with a wide variety of graphical development environments
  - We include *command line*, *RStudio* and *Visual Studio Code* practical elements in this course.  Please follow which you need.

- GitHub provides a web-based graphical interface 

- Also provides access control and several collaboration features, such as wikis and basic task management tools for every project


**Create a GitHub account**
  
- Visit https://github.com/

- Sign up

- Verify account

---

# Access a Linux machine

- Open an application called 'Putty'

- Host Name : `ssh.bangor.ac.uk`

- Click 'Open'

- Enter your university username and hit enter

- Enter your university password and hit enter

- Type `ssh compute` and hit enter

- Can see last login credentials?
  
  - `Last login: Thu Nov 14 08:33:32 2019 from ssh.ad.bangor.ac.uk`
  
- `$` Presented with a prompt, indicating that the **shell** is ready to accept input 

---

# Command Line: Access a Linux machine

- `ssh bangor-username@ssh.bangor.ac.uk`

- `ssh compute`

&lt;img src="images/cmd-ssh-compute.png" width=90%&gt;

---

# Command Line: What is a Shell?

.left-column[
  ![shell-layer](images/shell-layer.svg)
]

.right-column[

- A program that provides a user interface for Unix-like operating systems (kernel)

- Its job is to translate the user's commands into operating system instructions

- The operating system starts a shell for each user when they log in or open a terminal window

- Examples of Shells

  - Bourne Family: sh, ash, ksh, **bash**

  - C Family: csh, tcsh

  - Perl Family: perlsh, zoidberg

  - Microsoft Family: cmd.exe, Windows PowerShell
]

---

# Command Line: Configure Git

- Need to configure Git on the `compute` machine for your account

- Details below should match those when creating an account on GitHub

- Need to set your username

  - `git config --global user.name "issa16"`
  
- Need to set your email address

  - `git config --global user.email "issa16@bangor.ac.uk"`

- Optionally set the default text editor for Git

  - `git config --global core.editor "nano -w"`

- Username and password will be linked to your Git activity

- `--global` For every Git project, use these settings

---

# Theory: Line Endings

- Different Operating Systems using different characters to represent to the end of a line

- Git uses these characters to compare files, it may cause unexpected issues when editing a file on different machines

- `dos2unix` - Converts plain text files in DOS format to UNIX format

Linux and macOS

- `git config --global core.autocrlf input`

Windows

- `git config --global core.autocrlf true`

---

# Command Line: Check Git Config

`git config --list`

- You can change your configuration as many times as you want

&lt;img src="images/cmd-git-config.png" width=90%&gt;


---

# Git Config Help

- `git config --help`

- Press **q** to exit, **Spacebar** Go to next screen, **b** Go to the previous screen
  
#### Summary

Use `git config` to change the Git configuration and preferences

---
# RStudio and Git

- Version control doesn't have to be at the command-line. It integrates nicely with Development Environments as well.

- To use with RStudio, you must have these installed (for Windows):

  - R
    - https://cran.r-project.org/bin/windows/base/
  - RStudio
    - https://rstudio.com/products/rstudio/download/
  - Git
    - https://git-scm.com/download/win
    
- Once you have a repository in Github (creating a new one through Github's web interface is the easiest way, if necessary) you can check it out in RStudio and perform the full Version Control cycle therein.

---
# Visual Studio Code and Git



---
# Command Line: Create Local Repository

- `cd` Change your working directory to your *home* directory

- `mkdir hello_world` Create a directory named *hello_world*

- `cd hello_world` Change your working directory to the *hello_world* directory

- `git init` Initialise a git repository

  - Output: `Initialized empty Git repository in /some/path`?

- `git status` Check git status
  
  ```bash
  # On branch master
  #
  # Initial commit 
  #
  nothing to commit (create/copy files and use "git add" to track)
  ```


---
# Command Line: Create Local Repository

#### Note

- `git init` will include subdirectories and their files

&lt;img src="images/cmd-git-init.png" width=90%&gt;

---
# RStudio: Creating a Local Repository

It is not possible to create a local Git repository in RStudio's interface, but only to *clone* one that exists elsewhere - be it on a local file system or on GitHub.

So, to create a local one, use the command line and run *git init*.
In Windows, open *Command Prompt* and run something like this:

- `mkdir myrepo`
- `cd myrepo`
- `git init`

This local repository can then be *cloned* in RStudio via a local URL style like this:

&lt;img src="images/rstudio-clonelocalrepo.png" width=33%&gt;

---

# Command Line: Hello World Explained

- We created a directory named *hello_world* to store versions of our files

- `ls` Empty?

- `ls -a` Hidden files?

- Git uses a special sub-directory to store all the information about the project

- If we were to delete the `.git` directory, we would lose the project's history

- `git status`

#### Summary

- `git init` initialises a repository

- Git stores all of its repository data in the `.git` directory

---

# Command Line: Tracking Changes

- `cd ~/hello_world &amp;&amp; nano data.txt` 
  - Inside the `hello_world` directory create a file called `data.txt`

- Add random text or favourite song title, save the file and exit

- `cat data.txt` Verify save was successful

- `git status` Git has picked up a new file?

- `data.txt` is listed as an **Untracked File** 
  - This means that Git is not keeping track of the file

- `git add data.txt`
  - Git will now track this file
  
- `git status`?

---

# Command Line: Tracking Changes

- Git knows to track `data.txt` but hasn't recorded these changes as a commit

- `git commit -m "Added data.txt"`

- `git status`?

- `git commit` takes everything we have told it to save by using `git add` and stores
a copy permanently inside the special `.git` directory

- This permanent copy is called a *commit* or *revision*

- `git log` View recent history for git repository

- ` git log --oneline` Reduce the quantity of information 

---

# Command Line: Tracking Changes

- `nano data.txt` Add a new line of data

- `git status`?

- We have made changes, but we haven't told Git we want to save those changes

- `git diff --color-words` Good practise to review the changes first

- `git add data.txt`

- `git commit -m "Updated data.txt"`

- `git add` before `git commit` allows us to be selective on the files we want to commit to our repository

---
# RStudio: Tracking Changes
  - Modify a file from the working copy via the RStudio File Browser (bottom-right quadrant), once saved notice the 'Git' tab sees this file as *modified*:
  
  &lt;img src="images/rstudio-modified.png" width=33%&gt;
  
  - Now to *commit* this, we need to tick the box next to the file and press the commit button, after which we are presented with the *Review Changes* windows in which we see the commit being staged and also enter our *Commit message*:
  
  &lt;img src="images/rstudio-reviewchanges.png" width=33%&gt;
  
  - RStudio will then show the output of the Git commit.  We now see the message that "Your branch is ahead of 'origin/master' by 1 commit" showing that we have not pushed this change from the stage to the main repository origin.
  
---
# VS Code: Tracking Changes

---

# Command Line: Using Github
There are a couple of ways to use a Github repo as the backend storage for a repository.

For an existing local repo, connect your local git repo to GitHub like this:

1. Create a repo on Github using the web-based graphical interface 
  - Clone url : `https://github.com/issa16/test.git`
  
2. In your local shell run the following command to connect the remote repo on Github to your local repo
  - `git init`
  - `git remote add origin https://github.com/issa16/test.git`
  
3. Check the two repos are connected
  - `git remote -v`

4. One time operation to store credentials
  - `git config credential.helper store`

---
# Command Line: Using Github

Alternatively, create the project initially on GitHub and begin local work with a clone thereof:

1. Create a project on Github

2. Clone the repository
  - `cd ~ &amp;&amp; git clone https://some/url`
  
*We use HTTPS here because it does not require additional configuration. After the workshop, you may want to set up SSH access, which is more secure.*



---
# RStudio: Cloning from Github

To *clone* in RStudio from GitHub, we simply use a URL that points to the GitHub repo rather than a local repository.

- In RStudio start a new project: 

  - File -&gt; New Project -&gt; Version Control -&gt; Git
  
  &lt;img src="images/rstudio-newproject.png" width=33%&gt;
  &lt;img src="images/rstudio-createprojectfromversioncontrol.png" width=33%&gt;
  
  - If *Version Control* not available try restarting RStudio and/or reinstalling the required components as your system paths are most likely incorrect*
  


---
# RStudio: Cloning from Github  
  - Put the URL to the Github repository in (from the Github web interface under *Clone or download*), and consider where the local clone will go
  
  &lt;img src="images/rstudio-clonegitrepo.png" width=33%&gt;
  
  - Click *Create Project*
  
  - RStudio will clone the repository into a working copy and open therein.
  
  - Notice that the new window opened has a *Git* option in the top-right pane:
  
  &lt;img src="images/rstudio-gittab.png" width=33%&gt;
  
  - Buttons here represent the principal Git functions:
    - On the right we see the branch being used and are also able to create a new branch.
    - On the left we see options to compare files, commit files, pull, push, view history and set options. 
    
---
# VS Code: Cloning from Github
    

---
# Command Line: Push To Github

Once we have a working clone locally, we can push our changes to GitHub by first *committing* them as above, and then *pushing* them:

- `git push origin master` Push changes from the local repository to Github

- `git pull origin master` Pull changes from Github to the local repository    
    
---
# RStudio: Push to Github
  - Once we have staged changes and are ready to commit to the origin, this can be achieved either through the 'Review Changes' window or the main Git tab in the RStudio project editing window.
  - Simply select the green up arrow, provide your GitHub credentials if prompted and see a push result:
  
  &lt;img src="images/rstudio-pushed.png" width=33%&gt;
  
  - Our changes have now been pushed up to the repository on Github. 
  
---
# VS Code: Push to Github
  
  
---
# Command Line: Pull changes from Github

To *pull* (retrieve) changes to content stored that has been committed and pushed to the repo from elsewhere (perhaps, for example, we have a clone on another machine we use at home), we:

  - `git pull origin master`
  
We can then see the changes:
  
  - `ls`

And, we can view the commit logs that were pushed along with any code changes:
  - `git log --oneline`

---
# RStudio: Pull changes from Github

It's trivially easy to pull any changes from the GitHub repository for a working copy (clone) by pressing the blue down button:

&lt;img src="images/rstudio-pull.png" width=33%&gt;

Which will result in display of the Git activity:

&lt;img src="images/rstudio-pullresult.png" width=33%&gt;

---
# VS Code: Pull changes from Github



---


# Summary: Staging Area &amp; Repositories

Think of Git as taking snapshots or changes over the life of a project.

Files can be stored in
  - A project's working directory (user sees)
  - The staging area (where the next commit is being built-up)
  - The local repository (where the commits are permanently recorded)

- *ADD* specifies what will go in a snapshot (staging area)

- *COMMIT* takes the snapshot and makes a permanent record of it, multiple files typically being changed in one commit to represent a single functional change to the overall application.  Useful commit messages are a good idea for future tracking.

&lt;img src="images/git-staging-area.svg"&gt;

- *PUSH* takes the permanent record and stores it in the main repository (typically on GitHub)

- *PULL* updates our local working copy (clone) with changes from the repository


---

# Command Line: Ignoring Files

What if we have files that we do not want to track?
  - backups or intermediate files created during data analysis?
  
- `cd ~/hello_world`

- `touch a.dat b.dat c.dat` Do not want these files to be tracked

- `git status` Always listed and could distract us from changes that matter

- `nano .gitignore`

  - `*.dat` # Tells Git to ignore all .dat files
  
  - `!a.dat` # Except a.dat
  
  - `results` # Tells Git to ignore all files in the results directory
  
- `git status`? Much better

- Need to save our *.gitignore* file to our repository

---
# RStudio: Ignoring Files
Similarly, to ignore files in RStudio, under the 'Git' tab, we can click the Blue Settings Cog icon and choose ignore to adjust the list of ignored files (as itself stored in .gitignore):

&lt;img src="images/rstudio-ignore.png" width=33%&gt;

---
# VS Code: Ignoring Files


---

# Github and Collaboration

The power of version control systems comes into its own when we start to collaborate with other people.

It enables different people to develop different parts of a project, some elements experimentally, and eases the merging of these changes.

Version control allows a particular project state at a point in time to be stored forever. Typically this would denote major changes, such as a new version.

As changes are required to be attributed to a user, accountability is also introduced.  This, with helpful user interfaces and meaningful messages about change enable a far more collaborative working environment.



---

# Github Project Collaboration

To configure a GitHub hosted repository for collaboration among users, some simple settings are applied in the GitHub interface:

- Settings &gt; Collaborators

- Add a Collaborator

- The collaborator must accept access

- The collaborator must clone the repository

- Create a file with a unique name

- Add, commit, push to the repo

- Should see changes in GitHub from multiple users

---

# A Basic Collaborative Workflow

- `git pull origin master` Update your local repository

- `git add` Make your changes and stage them

- `git commit -m` Commit your changes

- `git push origin master` Upload the changes to GitHub

---

# Theory: Conflicts 
 
As soon as people can work on a document in parallel, conflicts will happen

- Version Control helps us to manage conflicts by providing tools to resolve overlapping changes

&lt;img src="images/conflict.svg"&gt;

---

# Theory: Conflicts

Conflicts exist when changes to a file in different working copies occur concurrently and thus clash with the repository during commit/push.

E.g.

- All users clone Aaron's repository on Github

- Aaron updates **test.txt**

- All users edit and move to commit and push **test.txt**

- Users can commit the change locally but Git won't let them push it to GitHub

- Why?

---

# Theory: Conflicts

### Practical

- Git rejects the push because it detects that the remote repository has new updates that have not been incorporated into the local clone working copy

- What we have to do is pull the changes from GitHub, merge them into the copy we’re currently working in, and then push that to Github

---
# Command Line: Conflicts

- `git pull origin master` - Pull in latest updates

- `nano test.txt`

  ```
  &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
  This is your edit
  =======
  This is aaron's edit
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;
  ```

- Need to decide which line is correct?  User process.

---
# Command Line: Conflict Resolution


---
# RStudio: Conflicts


---
# VS Code: Conflicts



---
# Also: GitHub Desktop

[GitHub Desktop](https://desktop.github.com/)


---

# Licensing

- When code or other creative work becomes public, it should include a **LICENSE** or **LICENSE.txt** in the base directory of the repository

- It should clearly state under which license the content is being made available

- Reusing creative works without a license is dangerous because the copyright holders could sue you for copyright infringement

- [Choose an open source license](https://choosealicense.com/)

- People who incorporate General Public License (GPL’d) software into their own software must make their software also open under the GPL license; most other open licenses do not require this

- The Creative Commons family of licenses allow people to mix and match requirements and restrictions on attribution, creation of derivative works, further sharing, and commercialisation

- People who are not lawyers should not try to write licenses from scratch

- [Beerware](https://en.wikipedia.org/wiki/Beerware)?!

---

# Citation

#### Basic

- You may want to include a file called **CITATION** or **CITATION.txt** that describes how to reference your project

- More detailed advice and other ways to make your code citable can be found at the [Software Sustainability Institute](https://www.software.ac.uk/how-cite-and-describe-software)

- [Example](http://swcarpentry.github.io/git-novice/12-citation/index.html)

#### Advanced

- [Official Tutorial: Making Your Code Citable](https://guides.github.com/activities/citable-code/)


---

# Resources

- https://swcarpentry.github.io/git-novice/

- Yammer - Research Computing Community

- https://github.com/BangorUniversity/Research-Computing-Community

- https://guides.github.com/
  
---
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
